var FusionPageBuilder=FusionPageBuilder||{};jQuery,FusionPageBuilder.Panel=Backbone.Model.extend({defaults:{type:"panel"}}),FusionPageBuilder.Tab=Backbone.Model.extend({defaults:{type:"tab"}}),FusionPageBuilder.SidebarView=Backbone.View.extend({template:FusionPageBuilder.template(jQuery("#fusion-builder-sidebar-template").html()),events:{"click .fusion-builder-toggles a":"switchContext","focus .fusion-builder-search":"initSearch","keypress .fusion-builder-search":"checkResults","click .fusion-builder-go-back":"switchInnerContext"},currentSectionTarget:!1,fbeOptionsAdded:!1,initialize:function(){this.toSearch=!1,this.poSearch=!1,this._showResults=_.debounce(_.bind(this.showResults,this),500),this.viewManager=jQuery.extend(!0,{},new FusionPageBuilder.ViewManager),this.panelData={open:!1,width:327,context:"to",dialog:!1},this.setPanelStates(),this.flatToObject=!1,this.flatPoObject=!1,this.searchContext="to",this.$body=jQuery("body"),this.$previewPanel=this.$body.find("#customize-preview"),this.listenTo(FusionEvents,"fusion-to-posts_slideshow_number-changed",this.recreatePoTab),this.listenTo(FusionEvents,"fusion-postMessage-custom_fonts",this.updateCustomFonts),this.listenTo(FusionEvents,"fusion-to-portfolio_equal_heights-changed",this.togglePortfolioEqualHeights),this.listenTo(FusionEvents,"fusion-app-setup",this.setup),this.listenTo(FusionEvents,"fusion-preferences-editing_mode-updated",this.setDialogMode),this.listenTo(FusionEvents,"fusion-preferences-sidebar_position-updated",this.setDialogMode),this.listenTo(FusionEvents,"fusion-preferences-sidebar_overlay-updated",this.setDialogMode)},render:function(){return this.$el.html(this.template(this.panelData)),this.addToPanels(),this.resizableDrag(),this.setPanelStyling(),this.setActiveTab(),this},setup:function(){this.addPoPanels(FusionApp.data.samePage),this.addFBEPanels(),this.setDialogMode(),this.setArchiveMode(),this.setPostTypeLabel(),!1===FusionApp.data.is_fusion_element&&void 0===FusionApp.data.template_category&&this.createEditShortcuts()},setDialogMode:function(){var e="undefined"!=typeof FusionApp&&void 0!==FusionApp.preferencesData&&FusionApp.preferencesData;e&&"dialog"===e.editing_mode?(this.$el.find("#customize-controls").attr("data-dialog",!0),this.updatePanelData("dialog",!0)):(this.$el.find("#customize-controls").attr("data-dialog",!1),this.updatePanelData("dialog",!1)),e&&("right"!==e.sidebar_position||this.$body.hasClass("sidebar-right")?"left"===e.sidebar_position&&this.$body.hasClass("sidebar-right")&&(this.$body.removeClass("sidebar-right"),this.destroyResizable(),this.resizableDrag(),this.setPanelStyling()):(this.$body.addClass("sidebar-right"),this.destroyResizable(),this.resizableDrag(),this.setPanelStyling()),"on"===e.sidebar_overlay?this.$previewPanel.addClass("fusion-overlay-mode"):this.$previewPanel.removeClass("fusion-overlay-mode"))},setPostTypeLabel:function(){var e=this.$el.find(".label.fusion-po-only");"fusion_tb_section"===FusionApp.data.postDetails.post_type&&0<e.length?e.html(e.data("layout")):e.html(e.data("name"))},setArchiveMode:function(){"undefined"!=typeof FusionApp&&FusionApp.data.is_archive?this.$el.find("#customize-controls").attr("data-archive",!0):this.$el.find("#customize-controls").attr("data-archive",!1),"undefined"!=typeof FusionApp&&this.$el.find("#customize-controls").attr("data-editor",FusionApp.builderActive)},createEditShortcuts:function(){var e,t=this,i=t.getFlatToObject(),n=t.getFlatPoObject(),s=jQuery("#fb-preview").contents().find("html"),o=jQuery.extend(!0,t.createShortcutsObject(i),t.createShortcutsObject(n,"po"));_.each(o,function(t,i){(e=s.find(i)).length&&!e.hasClass("fusion-panel-customizable")&&(e.append('<span class="fusion-panel-shortcuts-wrapper"><span class="fusion-panel-shortcuts">'+t.join("")+"</span></span>"),e.addClass("fusion-panel-customizable"),"static"===e.css("position")&&e.addClass("fusion-panel-customizable-needs-positioned"))}),s.on("click",".fusion-panel-shortcut",function(e){var i=jQuery(this);void 0===i.attr("href")&&(e.preventDefault(),t.shortcutClick(i))})},createShortcutsObject:function(e,t){var i,n,s={};return t=void 0!==t?t:"",_.each(e,function(e){"object"==typeof e.edit_shortcut&&(i="string"==typeof e.edit_shortcut.selector?e.edit_shortcut.selector.split(","):e.edit_shortcut.selector,_.each(i,function(i){i=i.trim(),_.each(e.edit_shortcut.shortcuts,function(o){var a,r=o.aria_label||!1,l="",u="",d="",p="",c="",f=jQuery.extend(!0,{},o);if(r){if(void 0!==f&&""!==f.disable_on_template_override&&void 0!==FusionApp.data.template_override&&void 0!==FusionApp.data.template_override[f.disable_on_template_override]&&!1!==FusionApp.data.template_override[f.disable_on_template_override])return;void 0!==f&&""!==f.link_to_template_if_override_active&&void 0!==FusionApp.data.template_override&&void 0!==FusionApp.data.template_override[f.link_to_template_if_override_active]&&!1!==FusionApp.data.template_override[f.link_to_template_if_override_active]&&(FusionApp.data.template_override[f.link_to_template_if_override_active].permalink&&-1!==FusionApp.data.template_override[f.link_to_template_if_override_active].permalink.indexOf("?")?f.link=FusionApp.data.template_override[f.link_to_template_if_override_active].permalink+"&fb-edit=1&target_post_id="+FusionApp.data.postDetails.post_id:f.link=FusionApp.data.template_override[f.link_to_template_if_override_active].permalink+"?fb-edit=1&target_post_id="+FusionApp.data.postDetails.post_id,f.target="_top",f.aria_label=void 0!==fusionBuilderText["edit_"+f.link_to_template_if_override_active+"_layout_section"]?fusionBuilderText["edit_"+f.link_to_template_if_override_active+"_layout_section"]:fusionBuilderText.edit_layout_section,void 0!==f.override_icon&&(u=o.override_icon)),void 0!==f.link?(l=void 0!==f.target?f.target:"_blank",a=void 0!==f.css_class?f.css_class:"",""===u&&(u=void 0!==f.icon?f.icon:"fusiona-pen"),p='<a class="fusion-panel-shortcut '+a+'" href="'+f.link+'" target="'+l+'" aria-label="'+f.aria_label+'"><span class="'+u+'"></span></a>'):(""===u&&(u=void 0!==f.icon?f.icon:"fusiona-cog"),void 0!==f.open_parent&&(d=' data-fusion-option-open-parent="true"'),void 0!==f.callback&&(c=' data-callback="'+f.callback+'"'),n=void 0!==f.context?f.context:t,p='<span class="fusion-panel-shortcut" data-fusion-option="'+e.id+'" aria-label="'+f.aria_label+'" data-context="'+n+'"'+d+c+'><span class="'+u+'"></span></span>'),void 0===s[i]&&(s[i]=[]),void 0!==f.order?s[i][f.order]=p:s[i].push(p)}})}))}),s},shortcutClick:function(e){e.attr("data-callback")&&"function"==typeof FusionApp.callback[e.attr("data-callback")]?FusionApp.callback[e.attr("data-callback")](e):this.openOption(e.data("fusion-option"),e.data("context"),e.data("fusion-option-open-parent"))},openOption:function(e,t,i){var n,s,o,a=this;void 0===t&&void 0!==this.getFlatPoObject()[e]&&"object"==typeof FusionApp.data.postMeta._fusion&&void 0!==FusionApp.data.postMeta._fusion[e]&&""!==FusionApp.data.postMeta._fusion[e]&&(t="po"),n="po"!==(t=void 0!==t&&t?t:"to")?this.getFlatToObject():this.getFlatPoObject(),s=n[e],o="object"==typeof s&&s.tab_id,!0===(i=void 0!==i&&i)&&(o=void 0!==s?s.parent_id:e),t=t.toLowerCase(),this.togglePanelState(t,!0),this.setActiveTab(t),s&&"FBE"===s.location&&this.switchActiveContext("#fusion-builder-sections-to","FBE"),this.$el.find("#tab-"+o).length&&this.$el.find("#tab-"+o).is(":visible")||(this.$el.find(".fusion-sidebar-section:visible #"+o).length?this.$el.find(".fusion-sidebar-section:visible #"+o).trigger("click"):this.$el.find(".fusion-sidebar-section:visible #heading_"+o).length&&(!0!==a.$el.find(".fusion-panels").is(":visible")&&(a.$el.find(".fusion-builder-custom-tab:visible .fusion-builder-go-back").trigger("click"),a.$el.find(".fusion-panels").show()),"true"!==this.$el.find(".fusion-sidebar-section:visible #heading_"+o).attr("aria-expanded")&&this.$el.find(".fusion-sidebar-section:visible #heading_"+o).trigger("click"))),setTimeout(function(){i||void 0===s?a.scrollToElement(a.$el.find(".fusion-sidebar-section:visible #heading_"+o)):a.scrollToElement(a.$el.find('[data-option-id="'+s.id+'"]:visible'))},50)},scrollToElement:function(e,t){var i=this.$el.find(".fusion-sidebar-section:visible .fusion-tabs"),n=this.$el.find(".fusion-builder-toggles").outerHeight()+this.$el.find(".fusion-panel-section-header-wrapper").outerHeight(),s=0;i.is(":visible")||(i=this.$el.find(".fusion-sidebar-section:visible .fusion-panels")),t=void 0===t||t,e.length&&(t?(s=e.position().top+i.scrollTop()-n,i.animate({scrollTop:s},450)):(s=e.position().top+i.scrollTop()-n,i.scrollTop(s)))},getFlatToObject:function(){var e={};return!1!==this.flatToObject?this.flatToObject:(_.each(customizer,function(t,i){_.each(t.fields,function(t,n){"sub-section"===t.type||"accordion"===t.type?_.each(t.fields,function(t,s){t.tab_id=n,t.location="TO",e[s]=t,t.parent_id=i}):(t.tab_id=i,t.location="TO",e[n]=t)})}),FusionApp.data&&FusionApp.data.fusionElementsOptions&&_.each(FusionApp.data.fusionElementsOptions,function(t,i){_.each(t.fields,function(t,n){"sub-section"===t.type||"accordion"===t.type?_.each(t.fields,function(t,i){t.tab_id=n,t.location="FBE",e[i]=t}):(t.tab_id=i,t.location="FBE",e[n]=t)})}),this.flatToObject=e,this.flatToObject)},getFlatPoObject:function(){var e={},t=jQuery.extend(!0,{},FusionApp.data.fusionPageOptions);return!1!==this.flatPoObject?this.flatPoObject:(_.each(t,function(t,i){_.each(t.fields,function(t,n){"sub-section"===t.type||"accordion"===t.type?_.each(t.fields,function(t,i){t.tab_id=n,t.location="po",e[i]=t}):(t.tab_id=i,t.location="po",e[n]=t)})}),this.flatPoObject=e,this.flatPoObject)},initSearch:function(){var e="TO",t={threshold:.3,minMatchCharLength:3,keys:["label"]};"po"===this.panelData.context&&(e="PO"),this.searchContext=e,"TO"===e?this.toSearch=new Fuse(_.values(this.getFlatToObject()),t):this.poSearch=new Fuse(_.values(this.getFlatPoObject()),t)},clearSearch:function(){this.$el.find(".fusion-builder-search").val("")},showToggles:function(){this.$el.find(".fusion-builder-toggles").show()},hideToggles:function(){this.$el.find(".fusion-builder-toggles").hide()},destroyResizable:function(){this.$el.find("#customize-controls").resizable("destroy")},resizableDrag:function(){var e=this,t=this.$el.find("#customize-controls"),i=this.$body.hasClass("sidebar-right")?"w":"e",n=new URLSearchParams(window.location.search),s=null!==n.get("sb-max")?parseInt(n.get("sb-max")):640;t.hover(function(){e.$body.addClass("fusion-preview-block")},function(){e.$body.hasClass("fusion-sidebar-resizing")||e.$body.removeClass("fusion-preview-block")}),t.resizable({handles:i,minWidth:327,maxWidth:s,start:function(){e.$body.addClass("fusion-preview-block").addClass("fusion-sidebar-resizing")},resize:function(t,i){var n=327>=i.size.width?327:i.size.width;n=s<n?s:n,e.$body.hasClass("sidebar-right")?e.$previewPanel.css("padding-right",n).css("padding-left",0):e.$previewPanel.css("padding-left",n).css("padding-right",0)},stop:function(i,n){var o=327>=n.size.width?327:n.size.width;o=s<o?s:o,e.$body.hasClass("sidebar-right")&&t.css({left:"auto",right:0}),e.updatePanelData("width",o),e.$body.removeClass("fusion-preview-block").removeClass("fusion-sidebar-resizing")}})},checkResults:function(e){this._showResults(e)},showResults:function(e){var t,i,n=jQuery(e.currentTarget).val(),s=this.panelData.context,o="po"!==s?this.toSearch.search(n):this.poSearch.search(n),a=this.$el.find("#fusion-builder-sections-"+s),r={};_.each(o,function(e){r[e.id]=e}),t={model:new FusionPageBuilder.Tab({fields:r,id:"fusion-builder-results",type:"search",label:fusionBuilderText.search_results,context:this.searchContext})},i=new FusionPageBuilder.TabView(t),this.clearTabs(s),a.find("#tab-fusion-builder-results").remove(),a.find(".fusion-tabs").append(i.render().el).show(),a.find(".fusion-tabs").show(),a.find(".fusion-panels, .fusion-tabs .fusion-builder-custom-tab").hide(),a.find("#tab-fusion-builder-results").show()},addToPanels:function(){var e=this,t=this.$el.find("#fusion-builder-sections-to .fusion-panels");_.each(customizer,function(i){var n,s,o=e.viewManager.generateCid();i.label&&(i.cid=o,i.context="TO",i.innerContext="TO",n=new FusionPageBuilder.Panel(i),s=new FusionPageBuilder.PanelView({model:n}),e.viewManager.addView(o,s),t.append(s.render().el))})},addFBEPanels:function(){var e=this,t=this.$el.find("#fusion-builder-sections-to .fusion-panels");e.fbeOptionsAdded||(_.each(FusionApp.data.fusionElementsOptions,function(i){var n,s,o=e.viewManager.generateCid();i.label&&(i.cid=o,i.context="TO",i.innerContext=void 0!==i.addon&&i.addon?"FBAO":"FBE",n=new FusionPageBuilder.Panel(i),s=new FusionPageBuilder.PanelView({model:n}),e.viewManager.addView(o,s),t.append(s.render().el))}),e.fbeOptionsAdded=!0)},updateLabels:function(){this.$el.find('.fusion-builder-toggles a[href="#fusion-builder-sections-po"] .fusion-po-label').addClass("hidden"),this.$el.find('.fusion-builder-toggles a[href="#fusion-builder-sections-ps"] .fusion-ps-label').addClass("hidden"),"archive"!==FusionApp.data.currentPage?(this.$el.find('.fusion-builder-toggles a[href="#fusion-builder-sections-po"] .fusion-page-options').removeClass("hidden"),this.$el.find('.fusion-builder-toggles a[href="#fusion-builder-sections-ps"] .fusion-page-settings').removeClass("hidden")):(this.$el.find('.fusion-builder-toggles a[href="#fusion-builder-sections-po"] .fusion-taxonomy-options').removeClass("hidden"),this.$el.find('.fusion-builder-toggles a[href="#fusion-builder-sections-ps"] .fusion-category-settings').removeClass("hidden"))},addPoPanels:function(e){var t=this.$el.find("#fusion-builder-sections-po .fusion-panels"),i=this;e&&t.find(".fusion-builder-custom-panel").length||(!e&&t.find(".fusion-builder-custom-panel").length&&(this.$el.find("#tab-fusion-builder-results").is(":visible")?this.$el.find("#tab-fusion-builder-results .fusion-builder-go-back").trigger("click"):(this.$el.find('#fusion-builder-tab .fusion-builder-custom-tab[data-type="PO"]').is(":visible")||this.$el.find('a[href="#fusion-builder-sections-po"].fusion-active').length)&&this.$el.find('a[href="#fusion-builder-sections-po"]').trigger("click"),this.clearPanels("po"),this.clearTabs("po")),_.each(FusionApp.data.fusionPageOptions,function(e){var n,s,o=i.viewManager.generateCid();e.label&&(e.cid=o,e.context="PO",n=new FusionPageBuilder.Panel(e),s=new FusionPageBuilder.PanelView({model:n}),t.append(s.render().el),i.viewManager.addView(o,s))}),jQuery('.fusion-builder-toggles [href="#fusion-builder-sections-po"]').hasClass("fusion-active")&&jQuery('.fusion-builder-toggles [href="#fusion-builder-sections-po"]').click())},clearPanels:function(e){var t,i,n=this;e=void 0===e?"to":e.toLowerCase(),(t=this.$el.find("#fusion-builder-sections-"+e+" .fusion-builder-custom-panel")).length&&t.each(function(){(i=n.viewManager.getView(jQuery(this).data("cid")))&&i.removePanel()})},clearTabs:function(e,t,i){var n,s,o,a=this;e=void 0===e?"to":e.toLowerCase(),n=this.$el.find("#fusion-builder-sections-"+e),s=void 0!==t&&t?n.find(".fusion-builder-custom-tab#"+t):n.find(".fusion-builder-custom-tab"),void 0!==i&&i&&(s=s.find('.fusion-builder-option[data-option-id="'+i+'"]').closest(".fusion-builder-custom-tab")),s.length&&s.each(function(){(o=a.viewManager.getView(jQuery(this).data("cid")))&&o.removeTab()})},clearInactiveTabs:function(e){var t,i,n=this;e=void 0===e?"to":e.toLowerCase(),(t=this.$el.find("#fusion-builder-sections-"+e).find(".fusion-builder-custom-tab:not( :visible )")).length&&t.each(function(){(i=n.viewManager.getView(jQuery(this).data("cid")))&&i.removeTab()})},recreatePanels:function(){this.clearPanels("po"),this.addPoPanels(!0)},refreshTo:function(){var e=this;this.$el.find("#fusion-builder-sections-to").show(),this.$el.find('#fusion-builder-tab .fusion-builder-custom-tab[data-type="TO"]').each(function(){e.viewManager.removeView(jQuery(this).data("cid")),jQuery(this).remove()})},switchContext:function(e){var t=jQuery(e.currentTarget),i=t.attr("href"),n=this.$el.find(i),s=i.replace("#fusion-builder-sections-","");e.preventDefault(),this.$el.find(".fusion-active").removeClass("fusion-active"),this.$el.find(".fusion-sidebar-section").hide(),n.show(),n.is("#fusion-builder-sections-eo")||!n.find(".fusion-tabs").is(":visible")||n.find(".fusion-tabs").find(".fusion-builder-custom-tab:visible").length||n.find(".fusion-panels").is(":visible")||(n.find(".fusion-tabs").hide(),n.find(".fusion-panels").show()),t.addClass("fusion-active"),this.setPanelContext(s)},closeSidebar:function(){this.updatePanelData("open",!1),this.setPanelStyling()},openSidebar:function(){this.updatePanelData("open",!0),this.setPanelStyling()},getPanelWidth:function(){return this.panelData.width},panelIsOpen:function(){return this.panelData.open},togglePanel:function(){this.panelIsOpen()?this.closeSidebar():this.openSidebar()},setPanelContext:function(e){this.$el.find("#customize-controls").attr("data-context",e),this.updatePanelData("context",e)},togglePanelState:function(e,t){var i=void 0===e?"to":e,n=this.panelData.context;t=void 0!==t,this.panelIsOpen()&&void 0!==n&&n&&i!==n?this.setActiveTab(i):t&&this.panelIsOpen()||(this.togglePanel(),this.setPanelStyling(),this.panelIsOpen()&&this.setActiveTab(i))},setPanelStyling:function(){var e=this.getPanelWidth(),t=this.$body.hasClass("sidebar-right")?"right":"left",i=this.$body.hasClass("sidebar-right")?"left":"right",n={width:e};n[t]=0,n[i]="auto",this.panelIsOpen()?(this.$body.addClass("expanded"),this.$previewPanel.css("padding-"+t,e).css("padding-"+i,0),this.$el.find("#customize-controls").css(n)):(this.$body.removeClass("expanded"),this.$previewPanel.css("padding-"+t,0).css("padding-"+i,0),this.$el.find("#customize-controls").css(t,-e).css(i,"auto").css("width",e)),FusionEvents.trigger("fusion-sidebar-toggled",this.panelIsOpen())},setActiveTab:function(e){var t=this.$el,i=void 0!==e&&e;e=void 0===e?this.panelData.context:e.toLowerCase(),i&&this.setPanelContext(e),t.find('.fusion-builder-toggles a[href="#fusion-builder-sections-'+e+'"]').hasClass("fusion-active")||(t.find(".fusion-builder-toggles > .fusion-active").removeClass("fusion-active"),t.find('.fusion-builder-toggles a[href="#fusion-builder-sections-'+e+'"]').trigger("click"))},updatePanelData:function(e,t){this.panelData[e]=t,this.storePanelStates(),"open"!==e&&"width"!==e||setTimeout(function(){FusionEvents.trigger("fusion-frame-size-changed")},500)},setPanelStates:function(){var e;if("undefined"!=typeof Storage&&localStorage.getItem("fusionPanel"))try{"object"==typeof(e=JSON.parse(localStorage.getItem("fusionPanel")))&&(this.panelData={open:void 0!==e.open&&e.open,width:void 0!==e.width?e.width:327,context:void 0!==e.context?e.context:"to",dialog:void 0!==e.dialog&&e.dialog})}catch(e){}},storePanelStates:function(){"undefined"!=typeof Storage&&localStorage.setItem("fusionPanel",JSON.stringify(this.panelData))},fixToValueName:function(e,t,i,n){var s,o=this.getFlatToObject();if(void 0!==o[e]&&void 0!==o[e].choices&&void 0!==o[e].choices[t]&&"yesno"!==i)return o[e].choices[t];switch("object"==typeof t&&(t=_.isEmpty(n)||void 0===t[n]?_.values(t).join(", "):t[n]),_.isString(t)&&awbPalette.getColorSlugFromCssVar(t)&&((s=awbPalette.getColorObject(awbPalette.getColorSlugFromCssVar(t)))||(s=awbPalette.getDefaultColorObject()),t=s.label),i){case"yesno":1==t?t="Yes":0==t&&(t="No");break;case"showhide":1==t?t="Show":0==t&&(t="Hide");break;case"reverseyesno":t=1==t||1==t?"No":"Yes"}return t},recreatePoTab:function(){var e,t,i,n=fusionSanitize.getOption("posts_slideshow_number"),s={};if(!1!==FusionApp.data.is_singular&&("post"===FusionApp.data.postDetails.post_type||"page"===FusionApp.data.postDetails.post_type||"avada_portfolio"===FusionApp.data.postDetails.post_type)){for(t=FusionApp.data.postDetails.post_type,jQuery.each(FusionApp.data.fusionPageOptions.fusion_page_settings_section.fields,function(e){-1!==e.indexOf("kd_featured-image-")&&delete FusionApp.data.fusionPageOptions.fusion_page_settings_section.fields[e]}),i=2;i<=n;i++)e="kd_featured-image-"+i+"_"+t+"_id",(s=jQuery.extend(!0,{},FusionApp.data.featured_image_default)).id=e,s.label=s.label.replace("$",i),s.partial_refresh[e]=jQuery.extend(!0,{},s.partial_refresh["kd_featured-image-$_#_id"]),delete s.partial_refresh["kd_featured-image-$_#_id"],FusionApp.data.fusionPageOptions.fusion_page_settings_section.fields[e]=jQuery.extend({},s);this.viewManager.removeView(this.$el.find("#tab-fusion_page_settings_section").data("cid")),this.$el.find("#tab-fusion_page_settings_section").remove()}},updateCustomFonts:function(){var e=this,t={action:"avada_custom_fonts_font_faces",fusion_load_nonce:fusionAppConfig.fusion_load_nonce,custom_fonts:FusionApp.settings.custom_fonts};return void 0===window.awbTypographySelect||void 0===window.awbTypographySelect.webfonts?(jQuery.when(window.awbTypographySelect.getWebFonts()).done(function(){e.updateCustomFonts()}),this):(window.awbTypographySelect.webfonts.custom=[],_.each(FusionApp.settings.custom_fonts.name,function(e){window.awbTypographySelect.webfonts.custom.push({family:e,label:e,variants:[]})}),jQuery.post(fusionAppConfig.ajaxurl,t,function(e){jQuery("#fb-preview").contents().find("head").find("#css-custom_fonts").length&&jQuery("#fb-preview").contents().find("head").find("#css-custom_fonts").remove(),jQuery("#fb-preview").contents().find("head").append('<style type="text/css" id="css-custom_fonts">'+e+"</style>")}),this.clearPanels("po"),this)},togglePortfolioEqualHeights:function(){"1"===fusionSanitize.getOption("portfolio_equal_heights")?jQuery("#fb-preview").contents().find(".fusion-portfolio-archive").addClass("fusion-portfolio-equal-heights"):jQuery("#fb-preview").contents().find(".fusion-portfolio-archive").removeClass("fusion-portfolio-equal-heights"),window.frames[0].dispatchEvent(new Event("fusion-element-render-fusion_portfolio"))},switchInnerContext:function(e){var t=jQuery(e.currentTarget),i=t.data("context"),n=t.data("trigger"),s=this.$el.find("a#"+n).closest(".fusion-builder-custom-panel");t.closest(".fusion-sidebar-section").attr("data-context",i),this.scrollToElement(s,!1)},switchActiveContext:function(e,t){this.$el.find(e).attr("data-context",t).scrollTop(0)},renderElementSettings:function(e){this.openSidebarAndShowEOTab(),this.$el.find("#fusion-builder-sections-eo").append(e.render().el),FusionPageBuilderApp.SettingsHelpers.renderDialogMoreOptions(e),this.changeTabTitle()},openSidebarAndShowEOTab:function(){var e=this.$el.find('.fusion-builder-toggles a[href="#fusion-builder-sections-eo"]');e.hasClass("fusion-active")||e.trigger("click"),this.panelIsOpen()||this.openSidebar(),this.$el.find("#fusion-builder-sections-eo").scrollTop(0)},changeTabTitle:function(){var e=this.$el.find('a[href="#fusion-builder-sections-eo"]');this.$el.find(".awb-builder-nav-wrapper").is(":visible")?(e.find(".label-navigator, .fusiona-navigator").removeClass("hidden"),e.find(".label-options, .fusiona-pen").addClass("hidden")):(e.find(".label-navigator, .fusiona-navigator").addClass("hidden"),e.find(".label-options, .fusiona-pen").removeClass("hidden"))}});FusionPageBuilder=FusionPageBuilder||{};jQuery,FusionPageBuilder.PanelView=Backbone.View.extend({template:FusionPageBuilder.template(jQuery("#fusion-builder-panel-template").html()),className:"fusion-builder-custom-panel",events:{"click .fusion-panel-link":"showTabs","click .fusion-sub-section-link":"showTabs"},initialize:function(){this.$el.attr("data-id",this.model.get("id")),this.$el.attr("data-cid",this.model.get("cid")),this.$el.attr("data-context",this.model.get("innerContext"))},render:function(){return this.setIcon(),this.$el.html(this.template(this.model.attributes)),this},setIcon:function(){var e=this.model.get("icon");void 0!==this.model.get("alt_icon")&&(e=this.model.get("alt_icon")),void 0!==e&&-1===e.indexOf("fusiona")?delete this.model.attributes.icon:this.model.set("icon",e)},removePanel:function(){FusionApp.sidebarView.viewManager.removeView(this.model.get("cid")),this.remove()},showTabs:function(e){var t,i,n,s,o,a,r=jQuery(e.currentTarget),l=r.closest(".fusion-sidebar-section"),u=FusionApp.sidebarView.viewManager.generateCid(),d=this.model.get("fields"),p=!1;if(e.preventDefault(),FusionApp.data.postMeta._fusion=FusionApp.data.postMeta._fusion||{},r.parent().find("li").length)"true"===r.parent().find("a.fusion-panel-link").attr("aria-expanded")&&(p=!0),l.find(".fusion-builder-custom-panel ul li").hide(),l.find(".fusion-builder-custom-panel ul a.fusion-panel-link").attr("aria-expanded","false"),p?(r.parent().find("li").hide(),r.parent().find("a.fusion-panel-link").attr("aria-expanded","false")):(r.parent().find("li").show(),r.parent().find("a.fusion-panel-link").attr("aria-expanded","true"));else{if(setTimeout(function(){0===(a=l.find(".fusion-panels").filter(":visible")).length&&(a=l.find(".fusion-tabs").filter(":visible")),a.scrollTop(0)},50),r.hasClass("fusion-sub-section-link")?t=d[n=r.attr("id")].fields:(n=this.model.get("id"),t=d),"shortcode_styling"===n||"fusion_builder_elements"===n)return void FusionApp.sidebarView.switchActiveContext("#fusion-builder-sections-to","FBE");if("fusion_builder_addons"===n)return void FusionApp.sidebarView.switchActiveContext("#fusion-builder-sections-to","FBAO");l.find(".fusion-builder-custom-tab#tab-"+n).length?(void 0!==(o=FusionApp.sidebarView.viewManager.getView(l.find(".fusion-builder-custom-tab#tab-"+n).data("cid")))&&o.initialCheckDependencies(),o.showTab()):(i={model:new FusionPageBuilder.Tab({fields:t,id:n,type:void 0!==this.model.get("innerContext")?this.model.get("innerContext").toUpperCase():this.model.get("context").toUpperCase(),cid:u,label:jQuery(e.currentTarget).data("label")})},s=new FusionPageBuilder.TabView(i),FusionApp.sidebarView.viewManager.addView(u,s),l.find(".fusion-tabs").append(s.render().el)),l.find(".fusion-tabs").show(),l.find(".fusion-panels").hide(),l.find(".fusion-builder-custom-tab:not( #tab-"+n+")").hide()}}}),jQuery,window.avadaPanelIFrame={fields:{},fieldOutputDependencies:{},applyCallback:function(e,t,i){return i=i||!1,_.isFunction(FusionApp.callback[t])?FusionApp.callback[t](e,i):_.isFunction(window[t])?window[t](e,i):_.isFunction(fusionSanitize[t])?fusionSanitize[t](e,i):_.isFunction(FusionPageBuilder.Callback.prototype[t])?FusionPageBuilder.Callback.prototype[t](e,i):e},applyRefreshCallbacks:function(e,t){var i=this,n=!0,s=i.getValueClone(t);return void 0!==e&&_.each(e,function(e){if(void 0===e.js_callback)return!1;e.js_callback[1]=_.isUndefined(e.js_callback[1])?"":e.js_callback[1],i.applyCallback(s,e.js_callback[0],e.js_callback[1])||(n=!1)}),n},partialRefresh:function(e,t,i,n){var s,o=FusionApp.getAjaxData("fusion_app_partial_refresh");_.each(t,function(e,i){var n=!1;e.skip_for_template&&(_.each(e.skip_for_template,function(e){FusionApp.data.template_override[e]&&(n=!0)}),n&&delete t[i])}),_.isEmpty(t)||(void 0!==t&&(_.each(t,function(e){(s=jQuery("#fb-preview").contents().find("body").find(e.selector)).length?s.append('<div id="fusion-loader"><span class="fusion-slider-loading"></span></div>'):(s=jQuery("#fb-preview").contents().find("head").find(e.selector)).length&&jQuery("body").append('<div id="fusion-loader"><span class="fusion-slider-loading"></span></div>')}),jQuery('li[data-option-id="'+e+'"]').addClass("partial-refresh-active")),o.partials=t,jQuery.ajax({type:"POST",url:fusionAppConfig.ajaxurl,dataType:"json",data:o,success:function(i){_.each(i,function(i,o){t[o].aria_label;var a="string"==typeof t[o].success_trigger_event?t[o].success_trigger_event.split(" "):t[o].success_trigger_event;i=FusionApp.removeScripts(i,n),s=jQuery("#fb-preview").contents().find("html").find(t[o].selector),void 0!==i?(i.length||(i=""),t[o].after?s.after(i):t[o].container_inclusive?s.replaceWith(i):s.html(i),jQuery("#fusion-loader").remove()):(s.html(""),jQuery("#fusion-loader").remove()),jQuery('li[data-option-id="'+e+'"]').removeClass("partial-refresh-active"),t[o].success_trigger_event&&_.each(a,function(e){window.dispatchEvent(new Event(e)),window.frames[0].window.dispatchEvent(new Event(e)),"function"==typeof window[e]&&window[e](),"function"==typeof window.frames[0].window[e]&&window.frames[0].window[e]()}),s.removeClass("fusion-panel-customizable"),FusionApp.sidebarView.createEditShortcuts()}),FusionApp.injectScripts(n),setTimeout(function(){jQuery("#fb-preview")[0].contentWindow.jQuery("body").trigger("fusion-partial-"+e)},100)}}))},getValueClone:function(e){return e},getPoToValue:function(e,t,i){var n=this.getGlobalMapKey(e);return void 0===i&&(i=!1),n?this.getPoToValueFromGlobalKey(n,t,i):null},getGlobalMapKey:function(e){var t=e;return _.each(["is_home","is_tag","is_category","is_author","is_date","is_singular_post"],function(i){if(FusionApp.data[i]&&_.find(fusionOptionNetworkNames,function(n,s){if(n[i]&&e===n[i])return t=s,!0}),t)return!0}),t},getPoToValueFromGlobalKey:function(e,t,i){var n,s=null,o=!1;if(FusionApp.settings[e]&&(s=FusionApp.settings[e]),-1!==e.indexOf("[")&&((n=e.split("["))[0]=n[0].replace("]",""),n[1]=n[1].replace("]",""),FusionApp.settings[n[0]]&&void 0!==FusionApp.settings[n[0]][n[1]]&&(s=FusionApp.settings[n[0]][n[1]])),void 0!==i&&i)return s;switch(fusionOptionNetworkNames[e]&&-1!==FusionApp.data.postDetails.post_id.toString().indexOf("-archive")&&fusionOptionNetworkNames[e].archive&&("object"==typeof fusionOptionNetworkNames[e].archive&&fusionOptionNetworkNames[e].archive[0]?FusionApp.settings[fusionOptionNetworkNames[e].archive[0]]&&(s=FusionApp.settings[fusionOptionNetworkNames[e].archive[0]],t&&"undefined"!==s[t]&&(s=s[t])):FusionApp.settings[fusionOptionNetworkNames[e].archive]&&(s=FusionApp.settings[fusionOptionNetworkNames[e].archive],t&&"undefined"!==s[t]&&(s=s[t]))),e){case"header_bg_repeat":case"header_bg_full":o=FusionApp.data.postMeta._fusion.header_bg_image&&""===FusionApp.data.postMeta._fusion.header_bg_image.url;break;case"bg_repeat":case"bg_full":o=FusionApp.data.postMeta._fusion.bg_image&&""===FusionApp.data.postMeta._fusion.bg_image.url;break;case"content_bg_repeat":case"content_bg_full":o=FusionApp.data.postMeta._fusion.content_bg_image&&""===FusionApp.data.postMeta._fusion.content_bg_image.url}return o||(void 0!==FusionApp.data.postMeta._fusion&&void 0!==FusionApp.data.postMeta._fusion[e]&&""!==FusionApp.data.postMeta._fusion[e]&&"default"!==FusionApp.data.postMeta._fusion[e]?s=FusionApp.data.postMeta._fusion[e]:void 0!==FusionApp.data.postMeta[e]&&""!==FusionApp.data.postMeta[e]&&"default"!==FusionApp.data.postMeta[e]&&(s=FusionApp.data.postMeta[e])),"page_title_bar"!==e&&"blog_show_page_title_bar"!==e&&"blog_page_title_bar"!==e||(s="no"===(s="yes_without_bar"===(s="yes"===(s=s.toLowerCase())?"bar_and_content":s)?"content_only":s)?"hide":s),s},addHoverElements:function(e){var t="";return"string"==typeof e&&e.indexOf(",")&&(e=e.split(",")),"string"==typeof e&&-1!==e.indexOf(":hover")?(t=e.replace(":hover",".hover")+",")+e:("object"==typeof e&&(e=_.toArray(e),_.each(e,function(i){-1!==i.indexOf(":hover")&&(t=i.replace(":hover",".hover"),e.push(t))})),e)},generateCSS:function(e,t,i,n,s,o){var a,r,l,u,d,p,c="TO"===n||"FBE"===n?FusionApp.settings:FusionApp.data.postMeta._fusion,f=this;c=c||{},a=(c="PS"===n?FusionApp.data.postDetails:c)[e],l=r=a,n="FBE"===n?"TO":n,f.needsPreviewUpdate(e,n)&&(u='<style type="text/css" id="css-'+e+'">',t&&_.each(t,function(t){if("PS"!==n&&(r=f.getPoToValue(e,t.choice)),t=_.defaults(t,{element:"",property:"",units:"",prefix:"",suffix:"",js_callback:!1,callback:!1,value_pattern:"$",pattern_replace:!1,media_query:!1,function:"style"}),t=jQuery.extend(!0,{},t),!_.isObject(l)||_.isUndefined(t.choice)||_.isUndefined(l[t.choice])||(r=l[t.choice]),"PO"!==n||_.isObject(l)||_.isUndefined(t.choice)||(r=c[t.choice]),s&&(t.element=f.addHoverElements(t.element)),_.isObject(t.element)&&(t.element=jQuery.map(t.element,function(e){return[e]}),t.element=t.element.join(",")),"attr"===t.function)f.elementAttrs(t,r);else if("html"===t.function)f.elementHtmlContent(t,r);else{if(FusionApp.sidebarView.flatToObject[e]&&FusionApp.sidebarView.flatToObject[e].type)switch(FusionApp.sidebarView.flatToObject[e].type){case"media":r=r&&r.url?r.url:"",t.property&&"background-image"===t.property&&""===r&&(r="none")}_.isObject(r)?(d=jQuery.extend(!0,{},t),_.each(r,function(e,i){!t.element||"margin"!==t.property&&"padding"!==t.property||"top"!==i&&"bottom"!==i&&"left"!==i&&"right"!==i?t.property&&""!==t.property||(d.property=i):d.property=t.property+"-"+i,u+=f.getSingleCSS(e,d)})):u+=f.getSingleCSS(r,t)}}),i&&_.each(i,function(t){var i=void 0!==t.po&&!1===t.po?f.getPoToValue(e,t.choice,!0):f.getPoToValue(e,t.choice,!1),n=":root";!_.isObject(i)||_.isUndefined(t.choice)||_.isUndefined(i[t.choice])||(i="font-style"!==t.choice&&"font-weight"!==t.choice||"string"!=typeof i["font-family"]||!i["font-family"].includes("var(")?i[t.choice]:window.awbTypographySelect.getVarString(l["font-family"],t.choice)),t.value_pattern=void 0===t.value_pattern?"$":t.value_pattern,i=i||"",t.choice&&i&&"object"==typeof i[t.choice]&&(i=i[t.choice]),t.exclude&&("string"==typeof t.exclude&&(t.exclude=[t.exclude]),_.each(t.exclude,function(e){i===e&&(i="")})),i=t.value_pattern.replace(/\$/g,i),void 0!==t.callback&&(i=f.applyCallback(i,t.callback[0],t.callback[1])),"string"==typeof t.element&&(n=t.element),"text-transform"===t.choice&&""===i&&(i="inherit"),u+=n+"{"+t.name+":"+i+";}"}),u+="</style>",jQuery("#fb-preview").contents().find("head").find("#css-"+e).length&&jQuery("#fb-preview").contents().find("head").find("#css-"+e).remove(),jQuery("#fb-preview").contents().find("head").append(u),p=["h1_typography","h2_typography","h3_typography","h4_typography","h5_typography","h6_typography"],_.contains(p,e)&&this.updateResponsiveTypography(e,a),"TO"===n||"FBE"===n?FusionApp.storedToCSS[e]=u:FusionApp.storedPoCSS[e]=u)},elementHtmlContent:function(e,t){!0!==this.getExcludeBool(t,e)&&(t=this.getCssValue(t,e),jQuery("#fb-preview").contents().find(e.element).html(t))},elementAttrs:function(e,t){var i,n,s=this.getExcludeBool(t,e);if(!_.isUndefined(e.attr)&&!_.isEmpty(e.attr)&&!0!==s&&(t=this.getCssValue(t,e),e.toLowerCase&&(t=t.toLowerCase()),""!==t)){if(n=jQuery("#fb-preview").contents().find(e.element),i=n.attr(e.attr),_.isUndefined(i)&&(i=""),!_.isUndefined(e.remove_attrs)&&!_.isEmpty(e.remove_attrs)&&""!==i)return _.each(e.remove_attrs,function(t){"class"===e.attr&&n.removeClass(t),i=(i=(i=i.split(t+",").join("")).split(t+" ").join("")).split(t).join("")}),i+=""!==i?" ":"",i+=t,void("class"===e.attr?n.addClass(i):n.attr(e.attr,i));n.attr(e.attr,t)}},liveUpdateCustomCSS:function(e){var t=void 0!==e?e:"";jQuery("#fb-preview").contents().find("#fusion-builder-custom-css").length&&jQuery("#fb-preview").contents().find("#fusion-builder-custom-css").html(t)},liveUpdatePageCustomCSS:function(e){jQuery("#fb-preview").contents().find("#fusion-builder-page-css").length?jQuery("#fb-preview").contents().find("#fusion-builder-page-css").html(e):(e='<style type="text/css" id="fusion-builder-page-css">'+e+"</style>",jQuery("#fb-preview").contents().find("#fusion-builder-custom-css").length?jQuery("#fb-preview").contents().find("#fusion-builder-custom-css").after(e):jQuery("#fb-preview").contents().find("head").append(e))},updateResponsiveTypography:function(e,t){var i=e.split("_")[0];"function"==typeof jQuery("#fb-preview")[0].contentWindow.fusionCalculateResponsiveTypeValues&&document.querySelector("#fb-preview").contentWindow.document.body.dispatchEvent(new CustomEvent("fusion-typography",{detail:{heading:i,values:t}}))},getSingleCSS:function(e,t){var i="";return!0===this.getExcludeBool(e,t)?"":(e=this.getCssValue(e,t),e=t.prefix+e+t.units+t.suffix,t.media_query&&(0===t.media_query.indexOf("fusion-")&&(t.media_query=fusionReturnMediaQuery(t.media_query)),i+=t.media_query+"{"),i+=t.element+"{"+t.property+":"+e+";}",t.media_query&&(i+="}"),!e||_.isEmpty(e)?"":i)},getExcludeBool:function(e,t){var i=!1;return _.isUndefined(t.exclude)||(e===t.exclude&&(i=!0),_.isArray(t.exclude)&&_.each(t.exclude,function(t){t==e&&(i=!0),!i&&_.isEmpty(t)&&_.isEmpty(e)&&(i=!0),i||_.isUndefined(e.url)||t!==e.url||(i=!0)})),i},getCssValue:function(e,t){return void 0!==t.value_pattern&&!1!==t.value_pattern&&(e=t.value_pattern.replace(/\$/g,e),t.pattern_replace&&_.each(t.pattern_replace,function(t,i){var n=t.replace(originalOptionName+"[","").replace("]",""),s=t;n!==t&&(s=FusionApp.settings[n]),e=e.replace(i,s).replace(i,s)})),t.js_callback?(t.js_callback[1]=_.isUndefined(t.js_callback[1])?"":t.js_callback[1],e=this.applyCallback(e,t.js_callback[0],t.js_callback[1])):t.callback&&(t.callback[1]=_.isUndefined(t.callback[1])?"":t.callback[1],e=this.applyCallback(e,t.callback[0],t.callback[1])),t.property&&"background-image"===t.property&&"string"==typeof e&&-1===e.indexOf("url(")&&-1!==e.indexOf("/")&&-1!==e.indexOf(".")&&-1===e.indexOf("-gradient(")&&(e="url("+e+")"),e},needsPreviewUpdate:function(e,t){return"scheme_type"===e||"post_title"===e||"name"===e||"TO"!==t||this.validateChangeContext(e,t)[1]===t},validateChangeContext:function(e,t){var i=e,n=!1,s={TAXO:"term",PO:"post",TO:"theme"};return t=void 0===s[t]?"TO":t,_.each(fusionOptionNetworkNames,function(o,a){!1===n&&(a===e||void 0!==o[s[t]]&&o[s[t]]===e)&&FusionApp.data.postMeta._fusion[i]&&""!==FusionApp.data.postMeta._fusion[i]&&"default"!==FusionApp.data.postMeta._fusion[i]&&(n=[i,t])}),!1===n?[i,"TO"]:n},populateFieldOutputDependencies:function(){var e,t=this;t.fieldOutputDependencies&&_.isEmpty(t.fieldOutputDependencies)&&(FusionApp.sidebarView.flatToObject&&!_.isEmpty(FusionApp.sidebarView.flatToObject)||FusionApp.sidebarView.getFlatToObject(),_.each(FusionApp.sidebarView.flatToObject,function(i){i.output&&_.each(i.output,function(n){n.js_callback&&n.js_callback&&n.js_callback[0]&&"conditional_return_value"===n.js_callback[0]&&_.each(n.js_callback[1].conditions,function(n){-1!==n[0].indexOf(originalOptionName+"[")&&(e=n[0].replace(originalOptionName+"[","").replace("]",""),t.fieldOutputDependencies[e]||(t.fieldOutputDependencies[e]=[]),-1===t.fieldOutputDependencies[e].indexOf(i.id)&&t.fieldOutputDependencies[e].push(i.id))}),n.pattern_replace&&_.each(n.pattern_replace,function(e,n){var s=e.replace(originalOptionName+"[","").replace("]","");t.fieldOutputDependencies[s]||(t.fieldOutputDependencies[s]=[]),-1===t.fieldOutputDependencies[s].indexOf(i.id)&&t.fieldOutputDependencies[s].push(i.id)})})}))}};FusionPageBuilder=FusionPageBuilder||{};jQuery,FusionPageBuilder.TabView=Backbone.View.extend({template:FusionPageBuilder.template(jQuery("#fusion-builder-tab-template").html()),events:{"click .fusion-builder-go-back":"showSections","change input":"optionChange","fusion-change input":"optionChange","keyup input:not(.fusion-slider-input)":"optionChange","change select":"optionChange","keyup textarea":"optionChange","change textarea":"optionChange","click .upload-image-remove":"removeImage","click .option-preview-toggle":"previewToggle","click .fusion-panel-description":"showHideDescription","click .fusion-panel-shortcut":"defaultPreview","click .fusion-quick-option":"quickOption","click .option-has-responsive":"showResponsiveOptions","click .fusion-responsive-options li a":"changeResponsiveOption","mouseleave .fusion-builder-option":"hideResponsiveOptions","click .option-has-state":"toggleStateOptions","click .fusion-state-options li a":"changeStateOption"},className:"fusion-builder-custom-tab",initialize:function(){this.$el.attr("id","tab-"+this.model.get("id")),this.$el.attr("data-cid",this.model.get("cid")),this.$el.attr("data-type",this.model.get("type")),this._updatePreview=_.debounce(_.bind(this.updatePreview,this),1e3),this._validateOption=_.debounce(_.bind(this.validateOption,this),1e3),this.options=this.model.get("fields"),this.type=this.model.get("type"),this.initialCheckDependencies(),this.activeStates={},this.$targetEl=!1,this._tempStateRemove=_.debounce(_.bind(this.tempStateRemove,this),3e3),this.hasSlug=!0,"import_export"===this.model.get("id")&&this.listenTo(FusionEvents,"fusion-to-changed",this.updateExportCode),"import_export_po"===this.model.get("id")&&(this.listenTo(FusionEvents,"fusion-po-changed",this.updateExportCode),this.listenTo(FusionEvents,"fusion-ps-changed",this.updateExportCode))},render:function(){return this.$el.html(this.template(this.model.attributes)),this.initOptions(),FusionApp.sidebarView.$el.find(".fusion-sidebar-section:visible").scrollTop(0),this},quickOption:function(e){var t=jQuery(e.target);e.preventDefault(),FusionApp.sidebarView.openOption(t.data("fusion-option"))},showTab:function(){this.$el.show(),FusionApp.sidebarView.$el.find(".fusion-sidebar-section:visible").scrollTop(0)},initialCheckDependencies:function(){var e=this;setTimeout(function(){"TO"!==e.type&&"PO"!==e.type&&"FBE"!==e.type||(e.dependencies=new FusionPageBuilder.Dependencies(e.options,e))},10)},optionChange:function(e){this.validateOption(e)&&(this.needsDebounce(e)?this._updatePreview(e):this.updatePreview(e))},removeTab:function(){FusionApp.sidebarView.viewManager.removeView(this.model.get("cid")),this.remove()},showHideDescription:function(e){var t=jQuery(e.currentTarget),i=t.closest(".fusion-builder-option").find(".fusion-tooltip-description"),n=i.text();t.closest(".fusion-builder-option").find(".description").first().slideToggle(250),i.text(n===fusionBuilderText.fusion_panel_desciption_show?fusionBuilderText.fusion_panel_desciption_hide:fusionBuilderText.fusion_panel_desciption_show),t.toggleClass("active")},defaultPreview:function(e){var t=jQuery(e.currentTarget);e&&e.preventDefault(),FusionApp.sidebarView&&(jQuery(".fusion-builder-toggles a").first().trigger("click"),FusionApp.sidebarView.openOption(t.data("fusion-option"),"to"))},initOptions:function(e){var t=void 0!==e&&e.length?e:this.$el;this.optionColorpicker(t),this.optionRadioButtonSet(t),this.optionCheckboxButtonSet(t),this.optionDimension(t),this.optionSelect(t),this.optionAjaxSelect(t),this.optionMultiSelect(),this.optionRange(t),this.optionUpload(t),this.optionMultiUpload(t),this.optionCodeBlock(t),this.optionTypography(t),this.optionTypographySets(t),this.optionSwitch(t),this.optionImport(t),this.optionExport(t),this.optionSortable(t),this.optionColorPalette(t),this.optionRaw(t),this.optionLinkSelector(t),this.optionHubSpotMap(t),this.optionMailchimpMap(t),this.optionIconpicker(t),this.optionLayoutConditions(t),this.optionTextarea(t),void 0===e&&(this.optionRepeater(this.type),this.optionToggle(this.type))},needsDebounce:function(e){var t=jQuery(e.currentTarget).closest(".fusion-builder-option"),i=t.data("option-id"),n=this.model.get("fields"),s=n[i];return void 0===s&&t.parent().hasClass("repeater-fields")&&(s=n[i=t.parent().closest(".fusion-builder-option").data("option-id")]),!!["primary_color"].includes(i)||(void 0===s||void 0===s.output&&void 0===s.css_vars&&(void 0===s.transport||"postMessage"!==s.transport))&&(void 0===s||"select"!==s.type&&"typography"!==s.type)},showSections:function(e){var t,i=this.$el.closest(".fusion-sidebar-section");e&&e.preventDefault(),"search"===this.model.get("type")?("PO"===(t=this.model.get("context"))||"PS"===t?(FusionApp.sidebarView.setActiveTab("po",t),jQuery("#fusion-builder-sections-po .fusion-panels").show()):(FusionApp.sidebarView.setActiveTab("to",t),jQuery("#fusion-builder-sections-to .fusion-panels").show()),FusionApp.sidebarView.clearSearch()):"TO"===this.model.get("type")?jQuery("#fusion-builder-sections-to .fusion-panels").show():"FBE"===this.model.get("type")?(FusionApp.sidebarView.switchActiveContext("#fusion-builder-sections-to","FBE"),i.find(".fusion-tabs").hide(),i.find(".fusion-panels").show()):"FBAO"===this.model.get("type")?(FusionApp.sidebarView.switchActiveContext("#fusion-builder-sections-to","FBAO"),i.find(".fusion-tabs").hide(),i.find(".fusion-panels").show()):jQuery("#fusion-builder-sections-po .fusion-panels").show(),this.$el.closest(".fusion-tabs").hide(),"fusion-builder-results"===this.model.get("id")?this.remove():FusionApp.sidebarView.scrollToElement(FusionApp.sidebarView.$el.find("a#"+this.model.get("id")).closest(".fusion-builder-custom-panel"),!1)},getValue:function(e,t,i){var n;return"checkbox"===e.attr("type")&&e.hasClass("fusion-select-option")?e.closest('[data-save-not-array="true"]').length?e.is(":checked")?i:"0":(i=[],_.each(e.parent().find(".fusion-select-option:checked"),function(e){i.push(jQuery(e).val())}),i):"checkbox"===e.attr("type")?e.is(":checked")?"1":"0":(e.hasClass("fusion-url-only-input")&&(n=e.closest(".fusion-upload-area").find(".fusion-image-as-object")).length&&n.val(JSON.stringify({url:i})).trigger("change"),jQuery(t.currentTarget).parents(".fusion-builder-option.code").length?this.codeEditorOption[jQuery(t.currentTarget).parents(".fusion-builder-option.code").attr("data-index")].getValue():(e.hasClass("fusion-with-default")&&(i=(i=e.parents(".fusion-builder-option").find(".fusion-hidden-value").val())||""),e.hasClass("fusion-repeater-value")&&""!==i&&(i=JSON.parse(i)),i))},needsUpdate:function(e,t,i,n){var s,o,a;return!(t===n[i]||e.hasClass("fusion-dont-update")||e.hasClass("fusion-import-file-input")||"demo_import"===i||(e.parents(".fusion-builder-option.repeater").length&&!e.hasClass("fusion-repeater-value")?(e.hasClass("fusion-image-as-object")&&(t=void 0===t||""===t?{url:""}:JSON.parse(t)),this.setRepeaterValue(e.parents(".fusion-builder-option.repeater").find(".fusion-repeater-value"),i,e.parents(".repeater-row").index(),t),1):""===t&&_.isUndefined(n[i])&&_.isUndefined(n[i])||e&&e.hasClass("color-picker")&&!e.hasClass("fusion-color-created")||e.hasClass("fusion-color-palette-color-picker")||_.isObject(n[i])&&e.parents(".fusion-builder-dimension").length&&t===n[i][e.attr("name")]||_.isObject(n[i])&&(e.closest(".fusion-builder-option.typography").length||e.closest(".fusion-builder-option.typography-sets").length)&&(-1!==e.attr("name").indexOf("[")&&(s=e.attr("name").split("["),o=n[s.shift().replace("]","")],a=s.pop().replace("]",""),s.length&&_.each(s,function(e){e=e.replace("]",""),void 0===o[e]&&(o[e]={}),o=o[e]})),void 0!==o[a]&&t===o[a])))},saveChange:function(e,t,i,n,s){var o,a,r;if(e.closest(".fusion-builder-option").hasClass("typography")||e.closest(".fusion-builder-option").hasClass("typography-sets")||(_.isObject(n[i])||_.isUndefined(n[i]))&&(e.parents(".fusion-builder-dimension").length||e.parents(".fusion-builder-repeater").length))if(_.isUndefined(n[i])&&(n[i]={}),-1!==e.attr("name").indexOf("["))if(o=e.attr("name").split("["),a=n[o.shift().replace("]","")],r=o.pop().replace("]",""),o.length&&_.each(o,function(e){e=e.replace("]",""),void 0===a[e]&&(a[e]={}),a=a[e]}),"variant"===r){if(a["font-weight"]===awbTypographySelect.getFontWeightFromVariant(t)&&a["font-style"]===awbTypographySelect.getFontStyleFromVariant(t))return;a.variant=t,a["font-weight"]=awbTypographySelect.getFontWeightFromVariant(t),a["font-style"]=awbTypographySelect.getFontStyleFromVariant(t)}else a[r]=t;else n[i][e.attr("name")]=t;else e.hasClass("fusion-image-as-object")||e.hasClass("awb-palette-save")?(t=JSON.parse(t),n[i]=t):n[i]=t;void 0!==FusionApp.contentChange&&("TO"===s||"FBE"===s?(FusionEvents.trigger("fusion-to-changed"),FusionEvents.trigger("fusion-to-"+i+"-changed"),FusionApp.contentChange("global","theme-option"),window.dispatchEvent(new Event("fusion-to-"+i+"-changed"))):"PO"===s||"TAXO"===s?(FusionEvents.trigger("fusion-po-changed"),FusionEvents.trigger("fusion-po-"+i+"-changed"),FusionApp.contentChange("page","page-option"),window.dispatchEvent(new Event("fusion-po-"+i+"-changed"))):"PS"===s&&(FusionEvents.trigger("fusion-ps-changed"),FusionEvents.trigger("fusion-"+i+"-changed"),FusionApp.contentChange("page","page-setting"),window.dispatchEvent(new Event("fusion-page-"+i+"-changed"))))},getSaveId:function(e,t,i){var n=this.model.get("fields");if("PO"===i){if(e.hasClass("fusion-po-dimension"))return e.attr("id");if(!_.isUndefined(n[t])&&_.isUndefined(n[t].not_pyre)&&FusionApp.data.singular)return t}return t},getSaveLocation:function(e,t){switch(e){case"FBE":case"TO":return FusionApp.settings;case"PS":return FusionApp.data.postDetails;case"PO":case"TAXO":return"_wp_page_template"===t||"_thumbnail_id"===t||"_fusion_builder_custom_css"===t?FusionApp.data.postMeta:(FusionApp.data.postMeta._fusion=FusionApp.data.postMeta._fusion||{},FusionApp.data.postMeta._fusion)}},updatePreview:function(e,t,i){var n=this,s=jQuery(e.currentTarget),o=s.parents(".fusion-builder-option"),a=o.data("option-id"),r=s.val(),l=o.data("type"),u=this.getSaveLocation(l,a),d=o.find(".option-preview-toggle").length,p=!1,c=this.getSaveId(s,a,l),f=this.model.get("fields");r=this.getValue(s,e,r),(!0===t||this.needsUpdate(s,r,c,u))&&(this.saveChange(s,r,c,u,l),"TO"!==l&&"FBE"!==l&&"PO"!==l||(FusionApp.createMapObjects(),"object"==typeof u[c]?(this.updateSettingsToParams(a+"["+s.attr("name")+"]",r),this.updateSettingsToExtras(a+"["+s.attr("name")+"]",r),this.updateSettingsToParams(a,u[c]),this.updateSettingsToExtras(a,u[c]),"TO"!==l&&"FBE"!==l||this.updateSettingsToPo(a,u[c])):(this.updateSettingsToParams(a,r),this.updateSettingsToExtras(a,r),"TO"!==l&&"FBE"!==l||this.updateSettingsToPo(a,r)),FusionEvents.trigger("fusion-preview-update",a,r)),f[a]&&"object"==typeof f[a].events&&_.each(f[a].events,function(e){FusionEvents.trigger(e,a,r)}),!1!==this.checkUpdateCallbacks(f[a])&&("post_title"===a&&this.maybeUpdateSlug(r),void 0!==jQuery(e.currentTarget).attr("class")&&"fusion-multiselect-input"===jQuery(e.currentTarget).attr("class")||f[a]&&(f[a].id&&"color_palette"===f[a].id||(f[a].id&&"custom_css"===f[a].id?avadaPanelIFrame.liveUpdateCustomCSS(r):f[a].id&&"_fusion_builder_custom_css"===f[a].id?avadaPanelIFrame.liveUpdatePageCustomCSS(r):!f[a].id||"seo_title"!==f[a].id&&"meta_description"!==f[a].id?!f[a].id||"visibility_small"!==f[a].id&&"visibility_medium"!==f[a].id?((f[a].output||f[a].css_vars)&&!1!==avadaPanelIFrame.applyRefreshCallbacks(f[a].css_vars,r)&&(d&&this.triggerTemporaryState(o),avadaPanelIFrame.generateCSS(c,f[a].output,f[a].css_vars,l,d,f[a].type),_.isUndefined(f[a].output_fields_trigger_change)||(i||(i=[a]),_.each(f[a].output_fields_trigger_change,function(e){-1===i.indexOf(e)&&(i.push(e),n.updatePreview({currentTarget:jQuery('.fusion-builder-option[data-option-id="'+e+'"] input')},!0,i))})),avadaPanelIFrame.populateFieldOutputDependencies(),avadaPanelIFrame.fieldOutputDependencies[a]&&(i||(i=[a]),_.each(avadaPanelIFrame.fieldOutputDependencies[a],function(e){-1===i.indexOf(e)&&(i.push(e),n.updatePreview({currentTarget:jQuery('.fusion-builder-option[data-option-id="'+e+'"] input')},!0,i))})),p=!0),_.isUndefined(f[a].partial_refresh)||_.isEmpty(f[a].partial_refresh)||!1!==avadaPanelIFrame.applyRefreshCallbacks(f[a].partial_refresh,r)&&(avadaPanelIFrame.partialRefresh(c,f[a].partial_refresh,r,this.model.get("cid")),p=!0),_.isUndefined(f[a].transport)||"postMessage"!==f[a].transport||(p=!0,FusionEvents.trigger("fusion-postMessage-"+a),window.dispatchEvent(new Event("fusion-postMessage-"+a))),p&&(_.isUndefined(f[a].transport)||"refresh"!==f[a].transport)||!1!==avadaPanelIFrame.applyRefreshCallbacks(f[a].full_refresh,r)&&(o.addClass("full-refresh-active"),FusionApp.fullRefresh(),FusionEvents.once("fusion-app-setup",function(){o.removeClass("full-refresh-active")}))):jQuery("#fusion-parent-window-css-vars").html(":root{--small_screen_width:"+FusionApp.settings.visibility_small+"px;}:root{--medium_screen_width:"+FusionApp.settings.visibility_medium+"px;}"):this.updateSEOMeta(f[a].id,r)))))},updateSEOMeta:function(e,t){"seo_title"===e&&(jQuery("#fb-preview").contents().find("title").html(t),jQuery("#fb-preview").contents().find('meta[property="og:title"]').length&&jQuery("#fb-preview").contents().find('meta[property="og:title"]').attr("content",t)),"meta_description"===e&&(jQuery("#fb-preview").contents().find('meta[name="description"]').length&&jQuery("#fb-preview").contents().find('meta[name="description"]').attr("content",t),jQuery("#fb-preview").contents().find('meta[property="og:description"]').length&&jQuery("#fb-preview").contents().find('meta[property="og:description"]').attr("content",t))},maybeUpdateSlug:function(e){var t,i,n,s=this.$el.find("#post_name");if(s.length&&(s.val()&&""!==s.val()||(this.hasSlug=!1),e&&""!==e&&!this.hasSlug)){for(e=e.replace(/^\s+|\s+$/g,"").toLowerCase(),i=0,n=(t="/_,:;").length;i<n;i++)e=e.replace(new RegExp(t.charAt(i),"g"),"aaaaeeeeiiiioooouuuunc------".charAt(i));e=e.replace(".","-").replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-"),s.val(e).trigger("change")}},cloneValue:function(e){return e},updateSettingsToParams:function(e,t,i){var n,s,o,a,r=this,l=r.cloneValue(t);i=void 0!==i&&i,_.isUndefined(FusionApp.settingsToParams[e])||_.each(FusionApp.settingsToParams[e],function(u){_.isUndefined(fusionAllElements[u.element])||(u.callback&&(o={id:e,type:r.model.get("type")},t=avadaPanelIFrame.applyCallback(l,u.callback,o)),fusionAllElements[u.element].defaults[u.param]=t,_.isUndefined(fusionAllElements[u.element].params[u.param])||_.isUndefined(fusionAllElements[u.element].params[u.param].default)||("colorpickeralpha"!==fusionAllElements[u.element].params[u.param].type&&"color"!==fusionAllElements[u.element].params[u.param].type&&"range"!==fusionAllElements[u.element].params[u.param].type||(fusionAllElements[u.element].params[u.param].default=t,1===(n=jQuery("."+u.element+' [data-option-id="'+u.param+'"]')).length&&FusionEvents.trigger("fusion-default-changed-"+n.closest(".fusion-builder-module-settings").attr("data-element-cid"),u.param,t)),jQuery('.description [data-fusion-option="'+e+'"]').length&&(a=jQuery('.description [data-fusion-option="'+e+'"]').closest(".fusion-builder-option").attr("class").split(" ").pop(),s=FusionApp.sidebarView.fixToValueName(e,t,a),jQuery('.description [data-fusion-option="'+e+'"]').html(s))),FusionEvents.trigger("fusion-param-default-update-"+u.param,t),i||(FusionEvents.trigger("fusion-global-update-"+u.element,u.param,t),r.triggerActiveStates()))})},updateSettingsToExtras:function(e,t,i){var n=this,s=n.cloneValue(t);"object"!=typeof FusionApp.settingsToExtras||_.isUndefined(FusionApp.settingsToExtras[e])||(i=void 0!==i&&i,_.each(FusionApp.settingsToExtras[e],function(e){_.isUndefined(fusionAllElements[e.element])||(e.callback&&(t=avadaPanelIFrame.applyCallback(s,e.callback,!1)),fusionAllElements[e.element].extras[e.param]=t,i||(FusionEvents.trigger("fusion-extra-update-"+e.element,e.param,t),n.triggerActiveStates()))}))},updateSettingsToPo:function(e,t){var i,n=this.cloneValue(t);_.isUndefined(FusionApp.settingsToPo[e])||_.isUndefined(FusionApp.data.fusionPageOptions)||_.isEmpty(FusionApp.data.fusionPageOptions)||_.each(FusionApp.settingsToPo[e],function(e){_.isUndefined(FusionApp.data.fusionPageOptions[e.tab])||_.isUndefined(FusionApp.data.fusionPageOptions[e.tab].fields[e.option])||(i=FusionApp.data.fusionPageOptions[e.tab].fields[e.option],e.callback&&(t=avadaPanelIFrame.applyCallback(n,e.callback,!1)),FusionApp.sidebarView.clearTabs("po",!1,e.option),"color-alpha"!==i.type&&"color"!==i.type&&"slider"!==i.type&&"sortable"!==i.type||(i.default=t))})},validateOption:function(e){var t=jQuery(e.currentTarget),i=t.val(),n=t.parents(".fusion-builder-option"),s=n.data("option-id"),o=!0,a="",r="";if(!t.hasClass("awb-ignore")){if("checkbox"===t.attr("type")&&(i=t.is(":checked")?"1":"0"),"string"==typeof i&&-1!==i.indexOf("var("))return FusionApp.validate.message("remove",s,t),!0;if(n.hasClass("text")||n.hasClass("textarea")){let e=i.trimStart(),o=i.trimEnd();i!==e&&i!==o?r=fusionBuilderTabL10n.lAndTWhiteSpace:i!==e?r=fusionBuilderTabL10n.leadingWhiteSpace:i!==o&&(r=fusionBuilderTabL10n.trailingWhiteSpace),r&&FusionApp.validate.message("add",s,t,r),n.hasClass("counter")&&this.setCounter(t)}else n.hasClass("spacing")||n.hasClass("dimension")?(o=FusionApp.validate.cssValue(i),a=fusionBuilderTabL10n.invalidCssValue):n.hasClass("color")?(o=FusionApp.validate.validateColor(i,"hex"),a=fusionBuilderTabL10n.invalidColor):n.hasClass("color-alpha")?(o=FusionApp.validate.validateColor(i),a=fusionBuilderTabL10n.invalidColor):n.hasClass("typography")&&("font-size"===t.attr("name")?(o=FusionApp.validate.cssValue(i),a=fusionBuilderTabL10n.invalidCssValueVar.replace("%s",t.attr("name"))):"line-height"!==t.attr("name")&&"letter-spacing"!==t.attr("name")||(o=FusionApp.validate.cssValue(i,!0),a=fusionBuilderTabL10n.invalidCssValueVar.replace("%s",t.attr("name"))));return!1===o?(FusionApp.validate.message("add",s,t,a),!1):(o&&!r&&FusionApp.validate.message("remove",s,t),!0)}},showResponsiveOptions:function(e){jQuery(e.currentTarget).parent().toggleClass("active-item")},changeResponsiveOption:function(e){var t=jQuery(e.currentTarget),i=jQuery(e.currentTarget).closest("li.active-item");jQuery(".fusion-builder-preview-"+t.data("indicator")).trigger("click"),i.removeClass("active-item")},hideResponsiveOptions:function(e){jQuery(e.currentTarget).find(".fusion-panel-options li.active-item").removeClass("active-item")},toggleStateOptions:function(e){jQuery(e.currentTarget).parent().toggleClass("active-item")},changeStateOption:function(e){var t=jQuery(e.currentTarget),i=jQuery(e.currentTarget).closest("li.active-item"),n=jQuery(e.currentTarget).closest("li.fusion-builder-option");const s=t.attr("data-indicator"),o=n.hasClass("is-option-state")?n.attr("data-default-state-option"):n.attr("data-option-id"),a=t.attr("data-param_name")?t.attr("data-param_name"):`${o}_${s}`,r=n.parent().find(`[data-option-id=${a}]`);if(r.attr("data-option-id")===n.attr("data-option-id"))return void i.removeClass("active-item");r.addClass("state-active");const l=i.find(".option-has-state");l.attr("data-connect-state")&&l.attr("data-connect-state").split(",").forEach(e=>{n.parent().find(`[data-option-id=${e}],  [data-default-state-option=${e}]`).find(".fusion-states-panel .fusion-state-options a[data-indicator= "+s+"]").click()}),r.find(".fusion-panel-options .option-preview-toggle")&&r.find(".fusion-panel-options .option-preview-toggle:not(.active)").click(),"default"===s&&n.find(".fusion-state-options li a").each(function(){const e=jQuery(this).attr("data-param_name");e&&n.parent().find(`li.fusion-builder-option[data-option-id=${e}] .fusion-panel-options .option-preview-toggle.active`).click()}),n.hasClass("is-option-state")?"default"===s?this.defaultState(e):n.removeClass("state-active"):"default"!==s&&n.addClass("state-inactive"),i.removeClass("active-item")},defaultState:function(e){var t=jQuery(e.currentTarget).closest("li.fusion-builder-option");t.parent().find(`[data-option-id=${t.attr("data-default-state-option")}]`).removeClass("state-inactive"),t.removeClass("state-active")},checkUpdateCallbacks:function(e){var t=!0,i=[],n=!1;return e&&e.id&&e.update_callback&&_.each(e.update_callback,function(e){var t;if(e.operator)switch(t=e.where?FusionApp.data[e.where]:FusionApp.data,e.operator){case"===":t[e.condition]!==e.value&&i.push(!1);break;case"!==":t[e.condition]===e.value&&i.push(!1)}else _.each(e,function(e){if(e.operator)switch(t=e.where?FusionApp.data[e.where]:FusionApp.data,e.operator){case"===":t[e.condition]===e.value&&(n=!0);break;case"!==":t[e.condition]!==e.value&&(n=!0)}}),i.push(n)}),_.each(i,function(e){e||(t=!1)}),t}}),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionTypographyField),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionTypographySetsField),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionCodeBlock),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionColorPicker),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionDimensionField),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionOptionUpload),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.radioButtonSet),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionCheckboxButtonSet),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionRangeField),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionRepeaterField),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionSelectField),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionAjaxSelect),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionMultiSelect),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionSwitchField),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionImportUpload),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionExport),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionSortable),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionColorPalette),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionRawField),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionLinkSelector),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionHubSpotMap),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionMailchimpMap),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionIconPicker),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionLayoutConditions),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionToggleField),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.options.fusionTextarea),_.extend(FusionPageBuilder.TabView.prototype,FusionPageBuilder.fusionActiveStates);FusionPageBuilder=FusionPageBuilder||{};jQuery,_.extend(FusionPageBuilder.Callback.prototype,{fusion_get_alpha:function(e){return jQuery.AWB_Color(e).alpha()},createSocialNetworks:function(){var e=[];return"0"!=FusionApp.settings.sharing_facebook&&e.push("facebook"),"0"!=FusionApp.settings.sharing_twitter&&e.push("twitter"),"0"!=FusionApp.settings.sharing_linkedin&&e.push("linkedin"),"0"!=FusionApp.settings.sharing_reddit&&e.push("reddit"),"0"!=FusionApp.settings.sharing_whatsapp&&e.push("whatsapp"),"0"!=FusionApp.settings.sharing_telegram&&e.push("telegram"),"0"!=FusionApp.settings.sharing_tumblr&&e.push("tumblr"),"0"!=FusionApp.settings.sharing_pinterest&&e.push("pinterest"),"0"!=FusionApp.settings.sharing_vk&&e.push("vk"),"0"!=FusionApp.settings.sharing_email&&e.push("mail"),e.join("|")},toYes:function(e){return 1==e||!0===e?"yes":"no"},toLowerCase:function(e){return e.toLowerCase()},urlFromObject:function(e){return"object"==typeof e&&void 0!==e.url?e.url:""},portfolioPaginationFormat:function(e){return e.toLowerCase().replace(/ /g,"").replace(/\_/g,"-").replace("scroll","").replace(/-\s*$/,"")},noPortfolioOnPage:function(){return!(0<jQuery("#fb-preview").contents().find(".fusion-portfolio-layout-grid, .fusion-portfolio-carousel").length)},isPaginationOnPage:function(){return 0!==jQuery("#fb-preview").contents().find(".pagination").length},isRolloverOnPage:function(){return 0!==jQuery("#fb-preview").contents().find(".fusion-image-wrapper").length},isMasonryOnPage:function(){return 0!==jQuery("#fb-preview").contents().find(".fusion-blog-layout-masonry, .fusion-portfolio-masonry, .fusion-gallery-layout-masonry").length},updateGridSeps:function(e){var t="",i=jQuery("#fb-preview").contents().find("div.fusion-content-sep");return _.each(e.split("|"),function(e){t+=" sep-"+e}),i.removeClass("sep-single sep-solid sep-double sep-dashed sep-dotted sep-shadow"),i.addClass(t),!0},timeLineColorCallback:function(){return!(0<jQuery("#fb-preview").contents().find(".fusion-blog-layout-masonry, .twitter-timeline-rendered").length)},fusionEditGlobalSidebar:function(e){var t="pages_sidebar";FusionApp.data.is_singular_post?t="posts_sidebar":FusionApp.data.is_portfolio_single?t="portfolio_sidebar":FusionApp.data.is_portfolio_archive?t="portfolio_archive_sidebar":FusionApp.data.is_search?t="search_sidebar":FusionApp.data.is_product?t="woo_sidebar":FusionApp.data.is_woo_archive?t="woocommerce_archive_sidebar":FusionApp.data.is_singular_ec?t="ec_sidebar":FusionApp.data.is_bbpress||FusionApp.data.is_buddypress?t="ppbress_sidebar":(FusionApp.data.is_home||FusionApp.data.is_archive&&!FusionApp.data.is_search)&&(t="blog_archive_sidebar"),-1<e.data("fusion-option").indexOf("_2")&&(t+="_2"),FusionApp.sidebarView.openOption(t,"to",e.data("fusion-option-open-parent"))},fusionEditFeaturedImage:function(e){FusionApp.sidebarView.openOption("_thumbnail_id","po",e.data("fusion-option-open-parent"))}});